package com.example.blackwidow;

/**
 * Created by Ryan on 11/28/2017.
 */

import android.content.Context;
import android.os.AsyncTask;
import android.util.Log;
import android.widget.Toast;

/**
 * Implementation of AsyncTask, to fetch the Route Stops data in the background away from
 * the UI thread.
 */
public class GetExploitsPostTask extends AsyncTask<ShodanPostRequest, Void, String> {
    private static final String TAGT = "GetExploitsTask";
    private long _hostID = -1;
    private IShodanPostCallback _postCallback;
    private Context _contextToUse;

    @Override
    protected String doInBackground(ShodanPostRequest... data) {
        Log.i(TAGT, "Posting Data: " + data[0].getPostData());

        try {
            _contextToUse = data[0].getPostContext();
            _postCallback = data[0].getPostCallback();
            _hostID = data[0].getHostID();
            return NetworkHelper.postToNetwork(data[0].getPostUrl(), data[0].getPostData());
        } catch (Exception e) {
            return "ERROR: " + e.getMessage();
        }
    }

    /**
     * Uses the logging framework to display the output of the fetch
     * operation in the log fragment.
     */
    @Override
    protected void onPostExecute(String result) {
        // Do something with the response from the website
        Log.i(TAGT, "Post response download completed...");

        if (!result.trim().startsWith("ERROR")) {
            Log.i(TAGT, "Data successfully downloaded!");
        } else {
            Log.i(TAGT, "Error downloading Shodan exploits --> " + result.trim());
            Toast.makeText(_contextToUse, "Error downloading Shodan exploits --> " + result.trim(), Toast.LENGTH_SHORT).show();
        }
        _postCallback.ShodanPostCallback(result, _hostID);
    }
}
